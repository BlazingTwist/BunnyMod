# Scratchpad
These are my test notes. Feel free to look around if you're curious about what I'm working on.

---

- https://streetsofrogue.fandom.com/wiki/Skill_Points_(XP)

- Possibly Mook masher:
    ```
    [Message: Bunny Mod] LoadLevel_SpawnRoamerSquad
    [Info   : Unity Log] 100% - SETUPMORE4
    [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
    Stack trace:
    BrainUpdate+<StartBrain>d__59.MoveNext () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)

    [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
    Stack trace:
    BrainUpdate+<StartBrain>d__59.MoveNext () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)

    [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
    Stack trace:
    BrainUpdate+<StartBrain>d__59.MoveNext () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)

    [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
    Stack trace:
    BrainUpdate+<StartBrain>d__59.MoveNext () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)

    [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
    Stack trace:
    BrainUpdate+<StartBrain>d__59.MoveNext () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)

    [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
    Stack trace:
    BrainUpdate+<StartBrain>d__59.MoveNext () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)
    ```

#
# Implementation
Features for the current update designated to be within scope.

---
## Afraid of Loud Noises
- if a silenced weapon runs out and the next one to be selected is too loud, it'll keep clicking the triggeron the quiet gun because it can't switch. Instead it should skip the loud one and switch to a quiet weapon even if out of order.
## DoubleTapper
- Hidden + unaware + distance
  - Attempted
- Headshot text no longer working
- Sleep + distance only
  - Attempted
## Eagle Eyes
- Test Upgrade - what happens?
- Also conflicts with Rogue Vision
  - That might be a good place to find if theere's one variable that can be adjusted for all of this.
- OnCamera methods to patch:
  - PositionOnCamera
    - Not yet, this is only used for StatusText. If the others work, go ahead and do this one.
  - ObjectRealOnCamer
    - Attempted
  - ItemOnCamera
    - Attempted
- PlayerAgent.agentCamera.ZoomFactor
- PlayerControl.myCamera.zoomLevel
- CameraScript.RealAwake
- None of these worked in vanilla
- Test with Rogue Vision
## Floor mods
- Here's a place where you can see it being changed.
  - BasicFloor.Spawn 
    - If FloorName == water & WaterToIce() then floorName = "Ice". Hopefully that's enough to do it.
      - First, test that we're back in a stable place with floor mod challenges. A lot has gone on and we're starting from scratch here.
## HasTrait
- Accept List as argument
## Reinforcements(+)
- AI seems broken; barely defend self or player
  - It's possible that this AI routine is not designed to respond to NPC attacks, since it was designed for roaming assassins. See what else is out there.
## Slot Machine
- Jackpot
  - Lovely!
  - Music doesn't stop though, even when destroyed
  - Music overlaps, make sure it's only triggering once
## Sniper
- Increase damage with range
- Disable Fire Spewer & other bullet types to clean up logs.
- May not even require being unaware? Not like it matters to a sniper.
- This uh... needs to be limited to the Revolver. Pistol gets insane.
- Also need to mod a distance requirement into enemies turning hostile when they find a body. I think they look for walls and a ray, and that's it. Note that objects don't obstruct the ray.
## Spelunky Dory
- Cave outcroppings
  - Placement looks good. Double or triple the quantity. 
  - Ensure They adjoin Cave Walls only, there should be enough example algos in that method to demonstrate how to do it.
  - Change from Altar to Wall
## Stealth Bastard Deluxe
- Open Doors Silently
  - Re-copied Door.Open
    - Didn't work
  - May want to check out Relationships.OwnCheck, or where and when it's called in these methods.
  - Attempted
    - Ensure that this doesn't allow you to completely avoid OwnCheck. There's a possibility it will go too far and you'll be able to open doors right in front of them.
- Hide Offset adjustment
  - Works well for Plant on North & South
  - Big Table doesn't work at all
  - Northwall Bathtub bounces out
## Special Floors (Sunken City / Transit Experiment)
- Both show in exteriors, not general city
- Ice is visual and affects movement, but no longer owned
- Water is visual only
- I think BasicFloors is for the actually defined floors, not the random ones. Deactivated that one for now.
  - Trying RandomFloorsWalls in the method we used for walls.
## Tampering (all)
- Ensure Sneaky Fingers applies
- These are playing noise where they didn't use to. Check vanilla and see where it shouldn't be.
## Trait Conflict custom method 
- Add series of strings and Lists of strings
- Exclude self, give self as argument
## Underdark Citizen
- Water splash
  - Needs a delay. It's appearing before the player is.
- Manhole to Toilet
  - Hasn't worked yet (tested with Diminutive too)
  - Occasionally returns to original manhole
  - Copy toilet exit algorithm, it needs to be directionalized
- I think this is causing false bush moves
## Veiled Threats
- Attempted
## Vendor Cart
- Quantity is the amount you get in a custom character though, not a reward amount. Find the generation list for the Vendor Stand drop and see
- Can be operated again if emptied, shows E_ as bufftext when completed
## Wall Mods
- Non-Randomized Walls
## Warlord
- Remove XP Extortion Reward
- Fix dialogue


#
# Fixing
Implemented features that have bug(s) that need to be fixed before release.

---
## StatusEffects.BecomeHidden 
- This is with the new logging added.
```
[Message: Bunny Mod] StatusEffects_BecomeHidden
[Message: Bunny Mod]    ObjectReal: null
[Message: Bunny Mod]    Agent: Cannibal
[Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
Stack trace:
BunnyMod.Content.BMAgents.StatusEffects_BecomeHidden (ObjectReal hiddenInObject, StatusEffects __instance) (at <f2d762100f78492980360d55eb0b7e89>:0)
StatusEffects.BecomeHidden (ObjectReal hiddenInObject) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
BunnyMod.Content.BMLevelGen+<LoadLevel_SetupMore3_3_Prefix_Replacement>d__33.MoveNext () (at <f2d762100f78492980360d55eb0b7e89>:0)
BunnyMod.Content.BMLevelGen+<LoadLevel_SetupMore3_3_Postfix>d__34.MoveNext () (at <f2d762100f78492980360d55eb0b7e89>:0)
UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)
```

#
# Balancing
Implemented and Bugfixed features that need balancing before release.

---

## Telemancy
- Miscast chance with Wild Casting is way too high, or not accurate enough.
- Reduce or at least randomize Dizzy duration. Guessing 5s instead of 10s.


#
# Finalization
- Do renames *only when the code is complete*.
- Complete and win a run with each new feature, and successfully load a return to home base. This would be a full cycle of the code you can expect to run into.
- Make a promo character for each special ability or trait group, to promote the mod and community at large.
- Update Sprites
- Increment the Version Number!

## Release Notes 

- New Mutators
- New Object Interactions
- New Traits

#
# Documentation Update Staging

## Mutators

All traits in categories marked with an asterisk (*) are mutually exclusive with the other traits *within* that category.
 
### Floors & Features *

*N.B.: If a chunk uses non-neutral floors, they will not be affected by floor mutators.*

✓- This mutator adds the feature to all districts

✗- This mutator prevents the feature from spawning

|Feature                 |Arcology Ecology   |Sunken City    |Transit Experiment |
|:-----------------------|:-----------------:|:-------------:|:-----------------:|
|Neutral Floors          |Grass              |Swimming Pool  |Skating Rink       |
|Alarm Button            |   |   |   |
|Barbecue                |   |   |✗ |
|Bear Trap               |   |   |   |
|Boulder                 |✓ |   |   |
|Bush                    |✓ |   |   |
|Cop                     |   |   |   |
|CopBot                  |   |   |   |
|Exploding SlimeBarrel   |✗ |   |   |
|Fire Hydrant            |   |   |   |
|Flame Grate             |   |   |✗ |
|Flaming Barrel          |   |   |✗ |
|Gangbanger              |   |   |   |
|Hobo                    |   |   |   |
|Lake                    |✓ |   |✗ |
|Lamp                    |   |   |   |
|Lockdown Wall           |   |   |   |
|Mafia                   |   |   |   |
|Manhole                 |   |   |   |
|Mayor                   |   |   |   |
|Mine                    |   |   |   |
|Musician                |   |   |   |
|Oil Spill               |✗ |   |   |
|Police Box              |   |   |   |
|Power Box               |   |   |   |
|SlimeBarrel             |✗ |   |   |
|Tracks                  |   |   |   |
|Trash Can               |✓ |   |   |
|Tree                    |✓ |   |   |
|Vending Machine         |   |   |   |
|Vendor Cart             |   |   |   |

### Map Size *

Standard Chunk count for a map is 30.

|Name                           |Chunks Per Map, est.|
|:------------------------------|-------------------:|
|A City for Ants?!              |4
|Claustrophobia                 |12
|Megalopolis                    |48
|Ultrapolis                     |64

### Population *

|Name                           |Roaming NPC Multiplier|
|:------------------------------|---------------------:|
|Ghost Town                     | 0 %
|Let Me See That Throng         | 400 %
|Swarm Welcome                  | 800 %

### Quest Count *

|Name                           |Force Quest Count Per Floor|
|:------------------------------|--------------------------:|
|Rushin' Revolution             |0
|Single-Minded                  |1
|Workhorse                      |4

### Quest Rewards *

|Name                           |Quest Rewards|
|:------------------------------|:------------|
|Double-Ply Rewards             |Free Item or Hire Vouchers
|Unpaid Internship              |Double XP only

### Roamers

|Name                           |Effect|
|:------------------------------|:-----|
|Hoodlum's Wonderland           |- Roaming Gang numbers increased (12 gangs for standard floor size)
|Mob Town                       |- Mafia Spawn in all Districts
|Young Men in the Neighborhood  |- Roaming Gangs spawn in all Districts

### Walls *

*N.B.: If a chunk uses non-randomized walls, they will not be affected by these mutators.*

|Name                           |Effect|
|:------------------------------|:-----|
|City of Steel                  |- All randomized walls will spawn as Steel.
|Green Living                   |- All randomized walls will spawn as Hedge.
|Panoptikopolis                 |- All randomized walls will spawn as Glass.
|Shanty Town                    |- All randomized walls will spawn as Wood.
|Spelunky Dory                  |- All randomized walls will spawn as Cave Wall.<br>- Boulders spawn in all districts.

---

## Object Interactions
- Manhole
  - Activate: Use Crowbar(15) to open
- Slot Machine
  - Added 1 & 100 denominations for gambling

## Traits

#### Combat

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Ballistician                   |2      |- Bullet range practically infinite<br>(They normally disappear offscreen - this is advised if you have Sniper & Eagle Eye)
|Double-Tapper                  |6      |- Bullet attack on unaware from melee range do 2x damage<br>- Increased to 10x if you're invisible or hidden
|Sniper                         |10     |- Bullet attack on unaware from long range do 2x damage<br>- Increased to 10x if you're invisible or hidden

#### Experience Gain Rate

|Name                           |Value  |Experience Rate|
|:------------------------------|------:|--------------:|
|Dim Bulb                       |- 4    |75 %
|Moronic                        |- 8    |50 %
|Smooth-Brained                 |- 16   |0 %
|Very Hard-On Yourself          |- 2    |XP Loss 200 %

#### Miscellaneous

|Name                           |Value  |Camera Zoom Level|
|:------------------------------|------:|----------------:|
|Eagle Eyes                     |3      |60 %
|Eagle Eyes +                   |6      |40 %
|Myopic                         |- 4    |150 %
|Myopic +                       |- 8    |200 %

#### Social

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Domineering                    |2      |- All NPCs 10% chance Submissive
|Domineering +                  |4      |- All NPCs 20% chance Submissive
|Generally Unpleasant           |- 3    |- All NPCs 20% chance Annoyed
|Objectively Unpleasant         |- 8    |- All NPCs Annoyed
|Polarizing                     |0      |- All NPCs Annoyed or Friendly.
|Polarizing +                   |1      |- All NPCS Hostile, Annoyed, Friendly, Loyal, or Aligned
|Priors                         |- 1    |- Law enforcement Annoyed<br>- Criminals Friendly
|Veiled Threats                 |3      |- When you attempt to Bribe, Extort, Mug, or Threaten, a failure will turn the target Annoyed instead of Hostile
|Warlord                        |20     |- Can make anyone Submissive by hurting them enough

#### Spawns

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Haunted                        |- 2    |- Three hostile ghosts spawn in each level, and search for you.
|Mob Debt                       |- 10   |- Start with a $1,000 Debt. Remove it at the Upgrade Machine.<br>- If you still have this trait at Level 10, the Mafia will send Hit Squads after you.
|Mook Masher                    |- 4    |- An increasing number of armed and hostile Goons will try to track you down on each level. 
|Reinforcements                 |5      |- Spawns three Aligned Resistance Leaders, who roam the level and defend you.
|Reinforcements +               |10     |- Your allies are now armed and armored.

#### Stealth

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Underdark Citizen              |2      |- Thieves and Cannibals hiding in Manholes no longer target you<br>- Activate or Fall in Open Manhole: Take no damage and teleport to another open Manhole<br>- Manholes spawn in all Districts

#
# Shelved
Out-of-scope features and notes for them; any bugs not worth fixing yet; avenues for codebase exploration

---

- AccessTools argument additions (new Type[1] {etc} often missing)
  - Slot machine may have been addressed

- RandomSelection.LoadRandomness is a good place to find lists to modify 

- RogueLibs conflicts not working right
    ```  
    Abbysssal — 
    Available determines whether a trait will exist in the game. 
    IsActive determines whether that trait will appear in the game (can be toggled on/off in the Traits Menu at Home Base).
    I think you should just patch StatusEffects.GetUpgradeTraits
    ```

## AnCapistan
  - Many XP rewards converted into money rewards
  - Objects now cost money
    - Alarm Buttons 
      - Attempted
            ```
            [Message: Bunny Mod] ObjectReal_Interact: AlarmButton (1664)
            [Message: Bunny Mod] AlarmButton_DetermineButtons
            [Warning:  HarmonyX] AccessTools.DeclaredMethod: Could not find method for type ObjectReal and name Interact and parameters ()
            [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
            Stack trace:
            BunnyMod.Content.BunnyHeaderTools.GetMethodWithoutOverrides[T] (System.Reflection.MethodInfo method, System.Object callFrom) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            BunnyMod.Content.BMObjects.AlarmButton_DetermineButtons (AlarmButton __instance) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            AlarmButton.DetermineButtons () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            PlayfieldObject.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            BunnyMod.Content.BMObjects.ObjectReal_Interact (Agent agent, ObjectReal __instance) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            ObjectReal.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            AlarmButton.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            InteractionHelper.UpdateInteractionHelper () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            Updater.UpdateInterface () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            Updater.Update () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            ```
    - Toilets 
      - Pay to use
    - Elevators 
      - Pay to use
    - Bathtubs 
      - Pay to use
    - Fire Hydrants 
      - Pay to use
      - No effect, but didn't have firefighter
            ```
            [Message: Bunny Mod] ObjectReal_Interact: FireHydrant (1679)
            [Info   : Unity Log] Window Lose Focus
            ```
  - NPCs
    - Firefighters
      - Only respond to fires in certain chunk types
      - Can pay them to put out fires if you want
    - More Thieves
    - More Drug Dealers
    - More Slum Dwellers
    - No Police, Cop Bots, or SuperCops
    - Upper Crusters 
      - Roam with bodyguards
      - Fewer in number
      - All aligned to each other
  - Purchase Admin access on computers

## MACITS
  - More happy/nature chunks
    - Greenhouse
    - Music Hall
  - Cops not annoyed at property damage
  - More musicians
  - Doctors are free
  - Replace Slum Dwellers and Upper-Crusters with Workers
  - No Thieves or Gangbangers
  - Vending machines almost all free
  - Chunks
    - No mansions/ gated communities/ Shacks
      - Replaced with simple houses and apartments
    - No arenas
    - No banks
    - No casinos
    - No churches
    - No Confiscation/Deportation Centers
    - No slave shops
    - No Zoos
## Police State
- Bribery disabled
- Chunks
  - Enable/disable, list already created
- Elevator requires access credentials 
  - Get from an UpperCruster
    - Neutralize, Mug, Pickpocket, etc.
      - Percent success based on skin/hair match
  - Register credentials in City database
    - Computer in Law Enforcement chunks
      - Ensure generation if not present in chunk
        - Random location within chunk
          - Far from door +
          - Owned Tiles +
          - In Cell ---
  - Buy fake pass from Fixer
    - Resistance Leader would work in meantime?
  - Hack Elevator
    - Failure means flood of law enforcement and lockout to that avenue
  - Bribe Clerk in Deportation Center
  - Buy Day Pass at Elevator
    - Not available if Wanted
    - Most expensive option
  - Shapeshifter in Upper-Cruster or other authorized person
- Roaming NPCs
  - Guilty NPCs automatically have Wanted, get beatdowns in public
  - Non-Humans no longer spawn in public areas
    - Cannibals
    - Zombies
    - Vampires
    - Werewolves are ok, they're hidden
- Secret Police NPC
  - Assassin-based
  - Silenced machine guns
  - This when you done fucked up good
- Security Cams
  - Always trigger for Wanted
  - Always trigger for Guilty
  - Don't spawn correctly on North-facing walls.
    - It is possible that SecurityCam has Snap-To-Wall behaviors built-in that Trashcans don't. 
      - Try removing this algorithm's snap-to-wall portions in order to not interrupt the Camera's code from doing its thing.
    - Postfixed SetVars with `shiftAmountS = -0.16f`
      - Didn't work
  - I think I get this algorithm now: the original spot they're locating is the blank between two placed trashcans. That's why you often see them right next to each other with a gap in between.
    - So you can probably greatly simplify this algorithm to just use the spot in the middle.
- The Law
  - This would be a whole different playstyle here, wouldn't it?
  - No removal of Wanted if you fuck up this badly. You're now persona non grata.
- Trait Contraindications
  - Cops Don't Care
    - They do
  - Wanted
    - You are
- Upper Cruster changes similar to AnCapistan
- Wanted Status
  - Not removeable if you have the Wanted trait to begin with
  - Applied if Cop goes Hostile
  - Can remove by accessing Police Station Computer
  - Applied automatically to all NPCs with Guilty
    - Exempt if Chunk Owner?
    - Types

#
# Shelved Release notes

## Overhauls

These are all accessed via the Mutators menu. These affect large swathes of gameplay content.

### AnCapistan
This just makes the game act like normal life in America. By the way, it's polite to *leave a tip* when someone mugs you.

---

#### Chunks
- All Law Enforcement chunks disabled
- All Criminal-type chunks made more common

#### Map Features
- All Pollution-related features made more common
- Most public good features disabled or made pay-only

#### NPCs
- Law Enforcement roaming NPCs disabled
- Criminal roaming NPCs made more common

#### Object Interactions
|Name                   |Effects
|:----------------------|
|Alarm Button           |- Now costs money
|Elevator               |- Now costs money
|Fire Hydrant           |- Now costs money
|Toilet                 |- Now costs money

### Mostly Automated Comfortable Inclusive Terrestrial Socialism
A post-scarcity mode. It's a lot easier and friendlier, if you're into that kind of thing. Turns out you thrive on conflict!

---

#### Chunks
- Artistic & Nature chunks more common
- Shacks & Mansions disabled, replaced with apartments

#### Map Features
- Public Good features more common
- Pollution features disabled

#### NPCs
- Healing with Doctor is always free
- Thieves no longer spawn

#### Object Interactions
|Name                   |Effects
|:----------------------|

### Police State
You saw how the last guy became the Mayor - did you think he was gonna be nice once he was in office?

Consider this one hard-mode.

---

#### Chunks
- Law Enforcement chunks always spawn
- Criminal-type chunks disabled

#### Map Features
- Pollution-related features disabled
- Security Cameras now generate in public
- 
#### NPCs
- Law Enforcers always spawn 
- Law Enforcers start out Annoyed
- If a Law Enforcer goes Hostile, you gain the Wanted Trait until you remove it [Methods TBD]
- Criminal roaming NPCs disabled

#### Object Interactions
|Name                   |Effects
|:----------------------|
|Security Cam           |- Triggers alarm if anyone Wanted is detected