# Scratchpad
These are my test notes. Feel free to look if you're curious about what I'm working on.

- GenEric requested data on item drops, provide that whenever possible

- FillMapChunks error
    ```
    [Message: Bunny Mod] LoadLevel_FillMapChunks_Replacement
    [Error  : Unity Log] FormatException: Input string was not in a correct format.
    Stack trace:
    System.Number.StringToNumber (System.String str, System.Globalization.NumberStyles options, System.Number+NumberBuffer& number, System.Globalization.NumberFormatInfo info, System.Boolean parseDecimal) (at <c79628fadf574d3a8feae0871fad28ef>:0)
    System.Number.ParseInt32 (System.String s, System.Globalization.NumberStyles style, System.Globalization.NumberFormatInfo info) (at <c79628fadf574d3a8feae0871fad28ef>:0)
    System.Int32.Parse (System.String s) (at <c79628fadf574d3a8feae0871fad28ef>:0)
    BunnyMod.Content.BMLevelGen+<LoadLevel_FillMapChunks_Replacement>d__26.MoveNext () (at <0d5f7d8a60534957a9f5db3c9e7281f0>:0)
    UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)
    UnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)
    BunnyMod.Content.<LoadLevel_loadStuff2_Replacement>d__30:MoveNext()
    UnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)
    LoadLevel:loadStuff()
    GameController:AwakenObjects()
    GameController:CreateMultPlayerAgent(GameObject, Int32)
    <WaitForRealStart>d__479:MoveNext()
    UnityEngine.SetupCoroutine:InvokeMoveNext(IEnumerator, IntPtr)
    ```
    - Attempted

#
# Implementation
Features for the current update designated to be within scope.

---
## Eagle Eyes
- Test Upgrade - what happens?
- NPC activity range needs to be increased
- Reduce UI scale
  - CanvasScaler.m_ScaleFactor
    - MainGUI.ShowInterfaceAnim
      - This also includes Inventory menus
        - InvSlot.TotalSlotNumber
## Initial Relationship traits
  - Set a gate to exclude the Home Base
    - Attempted
  - Maybe also exclude resistance leaders etc.
    - Attempted
## Manhole
- Cops go hostile when opened, even if not in view. 
  - Attempted
- Water splash
  - Needs a delay. It's appearing before the player is.
    - Attempted
- Manhole to Toilet
  - Occasionally returns to original manhole
    - Attempted
  - Copy toilet exit algorithm, it needs to be directionalized
    - Attempted
- Toilet to Manhole
  - Attempted
- Post-Operating name hover
## Toilet
- Toilet to Manhole
  - Didn't work
- Splash
  - Needs delay
- Pay to use
  - AnCapistan, out of scope
## Police State
- Cameras [F]
  - Police State Cameras don't spawn correctly on North-facing walls.
    - It is possible that SecurityCam has Snap-To-Wall behaviors built-in that Trashcans don't. 
      - Try removing this algorithm's snap-to-wall portions in order to not interrupt the Camera's code from doing its thing.
    - Postfixed SetVars with `shiftAmountS = -0.16f`
      - Didn't work
  - I think I get this algorithm now: the original spot they're locating is the blank between two placed trashcans. That's why you often see them right next to each other with a gap in between.
    - So you can probably greatly simplify this algorithm to just use the spot in the middle.
## Priors
  - No effect
    - This can be directly modelend on Wanted, to ensure completeness of the mod.
  - Ensure all law enforcement follow suit
## Reinforcements(+)
  - Need a stat boost
    - Attempted
  - No longer defending self or player
## Spelunky Dory
- Add random walls to outside of walls, use Trashcan algorithm
  - Attempted
## Stealth Bastard Deluxe
- Open Doors Silently
  - Doesn't seem to work. How best to test?
- Hide in Trashcans if you have Diminutive
- Interactable no longer true for:
  - Plant
  - Big table
  - Pool Table
  - Presumably bathtub
    - Best guesses:
      - Making interactability conditional on Trait check might be out of order; SetVars might take place before Agents are created.
### Warlord
  - No effect
## Special Floors (Sunken City / Transit Experiment)
    ```
    [Message: Bunny Mod] LoadLevel_FillMapChunks_Replacement
    [Info   : Unity Log] Player Info: Playerr (Agent) - Playerr - 0 - True -  - 1930
    [Message: Bunny Mod] LoadLevel_FillMapChunks2_Replacement
    [Info   : Unity Log] Set Level Theme: 0
    [Info   : Unity Log] RANDOM NUMBER 1.4: 469
    [Info   : Unity Log] RANDOM NUMBER 1.5: 19
    [Info   : Unity Log] Spawners Length: 472
    [Info   : Unity Log] RANDOM NUMBER 1.6: 448
    [Info   : Unity Log] RANDOM NUMBER 2: 469
    [Info   : Unity Log] RANDOM NUMBER 2.5: 469 - 135 - 0
    [Info   : Unity Log] RANDOM NUMBER 3.5: 469
    [Info   : Unity Log] RANDOM NUMBER 4: 469
    [Info   : Unity Log] RANDOM NUMBER 4.5: 469
    [Error  : Unity Log] Coroutine couldn't be started because the the game object 'SwitchFloor (1421)' is inactive!
    [Info   : Unity Log] RANDOM NUMBER 5: 857
    [Info   : Unity Log] RANDOM NUMBER 6: 560
    [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
    Stack trace:
    BunnyMod.Content.BMLevelGen.TileInfo_setFloor (System.Int32 x, System.Int32 y, System.Int32& tileNum, System.Int32& layerNum, TileInfo __instance) (at <41910907f99747ba8f4b5f4366bb3305>:0)
    TileInfo.setFloor (System.Int32 x, System.Int32 y, System.Int32 tileNum, System.Int32 layerNum) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    TileInfo.SetupFloorTile (System.Int32 x, System.Int32 y, System.Int32 layerNum) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    TileInfo.SetupFloorTiles (System.Boolean singleChunk, StreamingTileArray tempLastStreamingTileArray) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
    BunnyMod.Content.BMLevelGen+<LoadLevel_loadStuff2_Replacement>d__30.MoveNext () (at <41910907f99747ba8f4b5f4366bb3305>:0)
    UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)
    [Error  : Unity Log] Coroutine couldn't be started because the the game object 'SwitchFloor (1470)' is inactive!
    ```
    - Added logging to diagnose.
## Tamper Tantrum
  - Amended some apparent errors and clarified some names. Removed ref from arguments, seemed unnecessary .Test.
    - Yep, now it's incrementing it by an incorrect amount. Showed -7, incremented -15.
        ```
        [Message: Bunny Mod] ObjectReal_Interact: Stove (1192)
        [Message: Bunny Mod] ToolCost:
        [Message: Bunny Mod]    agent = Playerr
        [Message: Bunny Mod]    baseCost = 30
        [Message: Bunny Mod] Stove (1192): ObjectReal_PressedButton
        [Message: Bunny Mod] PlayfieldObject_Operating Stove (1192):
        [Message: Bunny Mod]     Agent = Playerr
        [Message: Bunny Mod]     item = Wrench
        [Message: Bunny Mod]     timeToUnlock = 2
        [Message: Bunny Mod]     makeNoise = True
        [Message: Bunny Mod]     barType = Tampering
        [Info   : Unity Log] HideInventory Sound Debug: False - False - False - False - False - False
        [Message: Bunny Mod] Stove (1192): ObjectReal_FinishedOperating
        [Message: Bunny Mod] Stove (1192): Stove_UseWrenchToDetonate
        [Message: Bunny Mod] Stove (1192): ObjectReal_MakeNonFunctional
        [Message: Bunny Mod] InvDatabase_SubtractFromItemCount_d:
        [Message: Bunny Mod]    InvItem = Wrench
        [Message: Bunny Mod]    amount = 30
        [Message: Bunny Mod]    toolbarMove = True
        [Message: Bunny Mod] SkillPoints_AddPointsLate
        [Message: Bunny Mod] SkillPoints_AddPointsLate_IEnumerator:
        [Message: Bunny Mod]    pointsType = TamperGeneratorPoints
        [Message: Bunny Mod]    extraNum = 1
        [Error  : Unity Log] Operating Bar Error 2
        [Message: Bunny Mod]    xpReward = 20
        ```
    -It's possible you're just passing it through that calculation twice, so it's getting cut in half twice for the button label but not the tool increment.
## Trait Conflict custom method 
- Add series of strings and Lists of strings
- Exclude self, give self as argument
## Vendor Cart
  - Bar filled, but then the bar just stayed and nothing happened
        ```
        [Message: Bunny Mod] ObjectReal_Interact: VendorCart (2443)
        [Message: Bunny Mod] VendorCart (2443): ObjectReal_PressedButton
        [Message: Bunny Mod] PlayfieldObject_Operating VendorCart (2443):
        [Message: Bunny Mod]     Agent = Playerr
        [Message: Bunny Mod] Logging error
        [Info   : Unity Log] HideInventory Sound Debug: False - False - False - False - False - False
        [Info   : Unity Log] SETRELHATE: Shopkeeper (1242) (Agent) - Playerr (Agent)
        [Message: Bunny Mod] VendorCart (2443): ObjectReal_FinishedOperating
        ```
        - Attempted with ObjectReal.FinishedOperating

#
# Fixing
Implemented features that have bug(s) that need to be fixed before release.

---
## Conflict showing Studious twice instead of superstudious
  - Attempted
## Trash Cans
- Button text empty
## Wall Mods
- Non-Randomized Walls

#
# Balancing
Implemented and Bugfixed features that need balancing before release.

---



#
# Finalization
- Do renames *only when the code is complete*.
- Complete and win a run with each new feature, and successfully load a return to home base. This would be a full cycle of the code you can expect to run into.
- Make a promo character for each special ability or trait group, to promote the mod and community at large.
- Update Sprites
- Increment the Version Number!

## Release Notes 

- New Mutators
- New Object Interactions
- New Traits

#
# Documentation Update Staging

## Mutators

All traits in categories marked with an asterisk (*) are mutually exclusive with the other traits *within* that category.
 
### Floors & Features *

*N.B.: If a chunk uses non-neutral floors, they will not be affected by floor mutators.*

✓- This mutator adds the feature to all districts

✗- This mutator prevents the feature from spawning

|Feature                 |Arcology Ecology   |Sunken City    |Transit Experiment |
|:-----------------------|:-----------------:|:-------------:|:-----------------:|
|Neutral Floors          |Grass              |Swimming Pool  |Skating Rink       |
|Alarm Button            |   |   |   |
|Barbecue                |   |   |✗ |
|Bear Trap               |   |   |   |
|Boulder                 |✓ |   |   |
|Bush                    |✓ |   |   |
|Cop                     |   |   |   |
|CopBot                  |   |   |   |
|Exploding SlimeBarrel   |✗ |   |   |
|Fire Hydrant            |   |   |   |
|Flame Grate             |   |   |✗ |
|Flaming Barrel          |   |   |✗ |
|Gangbanger              |   |   |   |
|Hobo                    |   |   |   |
|Lake                    |✓ |   |✗ |
|Lamp                    |   |   |   |
|Lockdown Wall           |   |   |   |
|Mafia                   |   |   |   |
|Manhole                 |   |   |   |
|Mayor                   |   |   |   |
|Mine                    |   |   |   |
|Musician                |   |   |   |
|Oil Spill               |✗ |   |   |
|Police Box              |   |   |   |
|Power Box               |   |   |   |
|SlimeBarrel             |✗ |   |   |
|Tracks                  |   |   |   |
|Trash Can               |✓ |   |   |
|Tree                    |✓ |   |   |
|Vending Machine         |   |   |   |
|Vendor Cart             |   |   |   |

### Map Size *

Standard Chunk count for a map is 30.

|Name                           |Chunks Per Map, est.|
|:------------------------------|-------------------:|
|A City for Ants?!              |4
|Claustrophobia                 |12
|Megalopolis                    |48
|Ultrapolis                     |64

### Population *

|Name                           |Roaming NPC Multiplier|
|:------------------------------|---------------------:|
|Ghost Town                     | 0 %
|Let Me See That Throng         | 400 %
|Swarm Welcome                  | 800 %

### Quest Count *

|Name                           |Force Quest Count Per Floor|
|:------------------------------|--------------------------:|
|Rushin' Revolution             |0
|Single-Minded                  |1
|Workhorse                      |4

### Quest Rewards *

|Name                           |Quest Rewards|
|:------------------------------|:------------|
|Double-Ply Rewards             |Free Item or Hire Vouchers
|Unpaid Internship              |Double XP only

### Roamers

|Name                           |Effect|
|:------------------------------|:-----|
|Hoodlum's Wonderland           |- Roaming Gang numbers increased (12 gangs for standard floor size)
|Mob Town                       |- Mafia Spawn in all Districts
|Young Men in the Neighborhood  |- Roaming Gangs spawn in all Districts

### Walls *

*N.B.: If a chunk uses non-randomized walls, they will not be affected by these mutators.*

|Name                           |Effect|
|:------------------------------|:-----|
|City of Steel                  |- All randomized walls will spawn as Steel.
|Green Living                   |- All randomized walls will spawn as Hedge.
|Panoptikopolis                 |- All randomized walls will spawn as Glass.
|Shanty Town                    |- All randomized walls will spawn as Wood.
|Spelunky Dory                  |- All randomized walls will spawn as Cave Wall.<br>- Boulders spawn in all districts.

---

## Object Interactions
- Manhole
  - Activate: Use Crowbar(15) to open

## Overhauls

These are all accessed via the Mutators menu. These affect large swathes of gameplay content.

### AnCapistan

### Chunks
- All Law Enforcement chunks disabled
- All Criminal-type chunks made more common

### Map Features
- All Pollution-related features made more common
- Most public good features disabled or made pay-only

### NPCs
- Law Enforcement roaming NPCs disabled
- Criminal roaming NPCs made more common

### Object Interactions
|Name                   |Effects
|:----------------------|
|Alarm Button           |- Now costs money
|Elevator               |- Now costs money
|Fire Hydrant           |- Now costs money
|Toilet                 |- Now costs money



### Mostly Automated Comfortable Inclusive Terrestrial Socialism

### Chunks
- Artistic & Nature chunks more common
- Shacks & Mansions disabled, replaced with apartments

### Map Features
- Public Good features more common
- Pollution features disabled

### NPCs
- Healing with Doctor is always free
- Thieves no longer spawn

### Object Interactions
|Name                   |Effects
|:----------------------|



### Police State

### Chunks
- Law Enforcement chunks always spawn
- Criminal-type chunks disabled

### Map Features
- Pollution-related features disabled
- Security Cameras now generate in public
- 
### NPCs
- Law Enforcers always spawn 
- Law Enforcers start out Annoyed
- If a Law Enforcer goes Hostile, you gain the Wanted Trait until you remove it [Methods TBD]
- Criminal roaming NPCs disabled

### Object Interactions
|Name                   |Effects
|:----------------------|
|Security Cam           |- Triggers alarm if anyone Wanted is detected

## Traits

### Additions

#### Experience Gain Rate

|Name                           |Value  |Experience Rate|
|:------------------------------|------:|--------------:|
|Dim Bulb                       |- 4    |75 %
|Moronic                        |- 8    |50 %
|Smooth-Brained                 |- 16   |0 %
|Very Hard-On Yourself          |- 2    |XP Loss 200 %

#### Miscellaneous

|Name                           |Value  |Camera Zoom Level|
|:------------------------------|------:|----------------:|
|Eagle Eyes                     |3      |60 %
|Eagle Eyes +                   |6      |40 %
|Myopic                         |- 4    |150 %
|Myopic +                       |- 8    |200 %

#### Social

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Domineering                    |2      |- 10% chance for NPC to be Submissive
|Domineering +                  |4      |- 20% chance for NPC to be Submissive
|Generally Unpleasant           |- 3    |- All NPCs have a 20% chance to start out Annoyed with you.
|Objectively Unpleasant         |- 8    |- All NPCs start out Annoyed.
|Polarizing                     |0      |- All NPCs start out either Annoyed or Friendly.
|Polarizing +                   |1      |- All NPCS start out Hostile, Annoyed, Friendly, Loyal, or Aligned.
|Veiled Threats                 |3      |- When you attempt to Bribe, Extort, Mug, or Threaten, a failure will turn the target Annoyed instead of Hostile.
|Warlord                        |16     |- You can make anyone Submissive by damaging them enough.

#### Spawns

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Haunted                        |- 2    |- Three hostile ghosts spawn in each level, and search for you.
|Mob Debt                       |- 10   |- Start with a $1,000 Debt. Remove it at the Upgrade Machine.<br>- If you still have this trait at Level 10, the Mafia will send Hit Squads after you.
|Mook Masher                    |- 4    |- An increasing number of armed and hostile Goons will try to track you down on each level. 
|Reinforcements                 |5      |- Spawns three Aligned Resistance Leaders, who roam the level and defend you.
|Reinforcements +               |10     |- Your allies are now armed and armored.

#### Stealth

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Underdark Citizen              |2      |- Thieves and Cannibals hiding in Manholes no longer target you<br>- Activate or Fall in Open Manhole: Take no damage and teleport to another open Manhole<br>- Manholes spawn in all Districts

#
# Shelved
Out-of-scope features and notes for them; any bugs not worth fixing yet; avenues for codebase exploration

---

- AccessTools argument additions (new Type[1] {etc} often missing)
  - Slot machine may have been addressed
- SlotMachine drop cash:
  - See ObjectReal.DestroyMe2 line 72

- RandomSelection.LoadRandomness is a good place to find lists to modify 

- RogueLibs conflicts not working right
    ```  
    Abbysssal — 
    Available determines whether a trait will exist in the game. 
    IsActive determines whether that trait will appear in the game (can be toggled on/off in the Traits Menu at Home Base).
    I think you should just patch StatusEffects.GetUpgradeTraits
    ```

## AnCapistan
  - Many XP rewards converted into money rewards
  - Objects now cost money
    - Alarm Buttons 
      - Attempted
            ```
            [Message: Bunny Mod] ObjectReal_Interact: AlarmButton (1664)
            [Message: Bunny Mod] AlarmButton_DetermineButtons
            [Warning:  HarmonyX] AccessTools.DeclaredMethod: Could not find method for type ObjectReal and name Interact and parameters ()
            [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
            Stack trace:
            BunnyMod.Content.BunnyHeaderTools.GetMethodWithoutOverrides[T] (System.Reflection.MethodInfo method, System.Object callFrom) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            BunnyMod.Content.BMObjects.AlarmButton_DetermineButtons (AlarmButton __instance) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            AlarmButton.DetermineButtons () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            PlayfieldObject.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            BunnyMod.Content.BMObjects.ObjectReal_Interact (Agent agent, ObjectReal __instance) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            ObjectReal.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            AlarmButton.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            InteractionHelper.UpdateInteractionHelper () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            Updater.UpdateInterface () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            Updater.Update () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            ```
    - Toilets 
      - Attempted
    - Elevators 
      - Attempted
    - Bathtubs 
    - Fire Hydrants 
      - No effect, but didn't have firefighter
            ```
            [Message: Bunny Mod] ObjectReal_Interact: FireHydrant (1679)
            [Info   : Unity Log] Window Lose Focus
            ```
  - NPCs
    - Firefighters
      - Only respond to fires in certain chunk types
      - Can pay them to put out fires if you want
    - More Thieves
    - More Drug Dealers
    - More Slum Dwellers
    - No Police, Cop Bots, or SuperCops
    - Upper Crusters 
      - Roam with bodyguards
      - Fewer in number
      - All aligned to each other
  - Purchase Admin access on computers

## MACITS
  - More happy/nature chunks
    - Greenhouse
    - Music Hall
  - Cops not annoyed at property damage
  - More musicians
  - Doctors are free
  - Replace Slum Dwellers and Upper-Crusters with Workers
  - No Thieves or Gangbangers
  - Vending machines almost all free
  - Chunks
    - No mansions/ gated communities/ Shacks
      - Replaced with simple houses and apartments
    - No arenas
    - No banks
    - No casinos
    - No churches
    - No Confiscation/Deportation Centers
    - No slave shops
    - No Zoos
## Police State
- Bribery disabled
- Chunks
  - Enable/disable, list already created
- Elevator requires access credentials 
  - Get from an UpperCruster
    - Neutralize, Mug, Pickpocket, etc.
      - Percent success based on skin/hair match
  - Register credentials in City database
    - Computer in Law Enforcement chunks
      - Ensure generation if not present in chunk
        - Random location within chunk
          - Far from door +
          - Owned Tiles +
          - In Cell ---
  - Buy fake pass from Fixer
    - Resistance Leader would work in meantime?
  - Hack Elevator
    - Failure means flood of law enforcement and lockout to that avenue
  - Bribe Clerk in Deportation Center
  - Buy Day Pass at Elevator
    - Not available if Wanted
    - Most expensive option
  - Shapeshifter in Upper-Cruster or other authorized person
- Roaming NPCs
  - Guilty NPCs automatically have Wanted, get beatdowns in public
  - Non-Humans no longer spawn in public areas
    - Cannibals
    - Zombies
    - Vampires
    - Werewolves are ok, they're hidden
- Secret Police NPC
  - Assassin-based
  - Silenced machine guns
  - This when you done fucked up good
- Security Cams
  - Always trigger for Wanted
  - Always trigger for Guilty
- The Law
  - This would be a whole different playstyle here, wouldn't it?
  - No removal of Wanted if you fuck up this badly. You're now persona non grata.
- Trait Contraindications
  - Cops Don't Care
    - They do
  - Wanted
    - You are
- Upper Cruster changes similar to AnCapistan
- Wanted Status
  - Not removeable if you have the Wanted trait to begin with
  - Applied if Cop goes Hostile
  - Can remove by accessing Police Station Computer
  - Applied automatically to all NPCs with Guilty
    - Exempt if Chunk Owner?
    - Types