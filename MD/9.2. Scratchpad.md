# Scratchpad
These are my test notes. Feel free to look if you're curious about what I'm working on.

---

- Floor mod
  - Here's a place where you can see it being changed.
  - BasicFloor.Spawn 
    - If FloorName == water & WaterToIce() then floorName = "Ice". Hopefully that's enough to do it.
- Need a custom HasTrait that will accept a List as an argument

## On load Park. 
- This is with the new logging added.
```
[Message: Bunny Mod] StatusEffects_BecomeHidden
[Message: Bunny Mod]    ObjectReal: null
[Message: Bunny Mod]    Agent: Cannibal
[Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
Stack trace:
BunnyMod.Content.BMAgents.StatusEffects_BecomeHidden (ObjectReal hiddenInObject, StatusEffects __instance) (at <f2d762100f78492980360d55eb0b7e89>:0)
StatusEffects.BecomeHidden (ObjectReal hiddenInObject) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
BunnyMod.Content.BMLevelGen+<LoadLevel_SetupMore3_3_Prefix_Replacement>d__33.MoveNext () (at <f2d762100f78492980360d55eb0b7e89>:0)
BunnyMod.Content.BMLevelGen+<LoadLevel_SetupMore3_3_Postfix>d__34.MoveNext () (at <f2d762100f78492980360d55eb0b7e89>:0)
UnityEngine.SetupCoroutine.InvokeMoveNext (System.Collections.IEnumerator enumerator, System.IntPtr returnValueAddress) (at <73b499366e5241bda47e5da76897738b>:0)
```

#
# Implementation
Features for the current update designated to be within scope.

---
## DoubleTapper
- Direction
  - DW
- NPC unawareness
  - DW
- Test hidden & invisible
  - Attempted
- Distance
  - DW
## Eagle Eyes
- Can't debug this one until it's reenabled, but it's a self-conflicted trait.
  - No really, it's got itself in its conflicts so you need to iron it out.
  - Attempted
- Test Upgrade - what happens?
- NPC activity range needs to be increased
- Reduce UI scale
  - CanvasScaler.m_ScaleFactor
    - MainGUI.ShowInterfaceAnim
      - This also includes Inventory menus
        - InvSlot.TotalSlotNumber
## Reinforcements(+)
  - Need a stat boost
    - Attempted
  - No longer defending self or player
## Slot Machine
- Add Jackpot
## Sniper
- Attempted
- Disable Fire Spewer & other bullet types to clean up logs.
- I think these endpoint methods aren't triggering for bullets. They might be for flames and stuff like that.
## Spelunky Dory
- Cave outcroppings
  - Placement looks good. Double or triple the quantity. 
  - Ensure They adjoin Cave Walls only, there should be enough example algos in that method to demonstrate how to do it.
  - Change from Altar to Wall
## Stealth Bastard Deluxe
- Open Doors Silently
  - Re-copied Door.Open
    - Didn't work
  - May want to check out Relationships.OwnCheck, or where and when it's called in these methods.
  - Attempted
    - Ensure that this doesn't allow you to completely avoid OwnCheck. There's a possibility it will go too far and you'll be able to open doors right in front of them.
- Hiding trapped bug
- Non-interactable objects persisting
  - Either find another method or just make them always interactable.
## Special Floors (Sunken City / Transit Experiment)
- Both show in exteriors, not general city
- Ice is visual and affects movement, but no longer owned
- Water is visual only
- I think BasicFloors is for the actually defined floors, not the random ones. Deactivated that one for now.
  - Trying RandomFloorsWalls in the method we used for walls.
## Trait Conflict custom method 
- Add series of strings and Lists of strings
- Exclude self, give self as argument
## Underdark Citizen
- Water splash
  - Needs a delay. It's appearing before the player is.
- Manhole to Toilet
  - Hasn't worked yet (tested with Diminutive too)
  - Occasionally returns to original manhole
  - Copy toilet exit algorithm, it needs to be directionalized
## Vendor Cart
  - Bar filled, but then the bar just stayed and nothing happened
        ```
        [Message: Bunny Mod] ObjectReal_Interact: VendorCart (2443)
        [Message: Bunny Mod] VendorCart (2443): ObjectReal_PressedButton
        [Message: Bunny Mod] PlayfieldObject_Operating VendorCart (2443):
        [Message: Bunny Mod]     Agent = Playerr
        [Message: Bunny Mod] Logging error
        [Info   : Unity Log] HideInventory Sound Debug: False - False - False - False - False - False
        [Info   : Unity Log] SETRELHATE: Shopkeeper (1242) (Agent) - Playerr (Agent)
        [Message: Bunny Mod] VendorCart (2443): ObjectReal_FinishedOperating
        ```
        - Attempted with ObjectReal.FinishedOperating
#
# Fixing
Implemented features that have bug(s) that need to be fixed before release.

---
## Wall Mods
- Non-Randomized Walls

#
# Balancing
Implemented and Bugfixed features that need balancing before release.

---

## Telemancy
- Miscast chance with Wild Casting is way too high, or not accurate enough.
- Reduce or at least randomize Dizzy duration. Guessing 5s instead of 10s.


#
# Finalization
- Do renames *only when the code is complete*.
- Complete and win a run with each new feature, and successfully load a return to home base. This would be a full cycle of the code you can expect to run into.
- Make a promo character for each special ability or trait group, to promote the mod and community at large.
- Update Sprites
- Increment the Version Number!

## Release Notes 

- New Mutators
- New Object Interactions
- New Traits

#
# Documentation Update Staging

## Mutators

All traits in categories marked with an asterisk (*) are mutually exclusive with the other traits *within* that category.
 
### Floors & Features *

*N.B.: If a chunk uses non-neutral floors, they will not be affected by floor mutators.*

✓- This mutator adds the feature to all districts

✗- This mutator prevents the feature from spawning

|Feature                 |Arcology Ecology   |Sunken City    |Transit Experiment |
|:-----------------------|:-----------------:|:-------------:|:-----------------:|
|Neutral Floors          |Grass              |Swimming Pool  |Skating Rink       |
|Alarm Button            |   |   |   |
|Barbecue                |   |   |✗ |
|Bear Trap               |   |   |   |
|Boulder                 |✓ |   |   |
|Bush                    |✓ |   |   |
|Cop                     |   |   |   |
|CopBot                  |   |   |   |
|Exploding SlimeBarrel   |✗ |   |   |
|Fire Hydrant            |   |   |   |
|Flame Grate             |   |   |✗ |
|Flaming Barrel          |   |   |✗ |
|Gangbanger              |   |   |   |
|Hobo                    |   |   |   |
|Lake                    |✓ |   |✗ |
|Lamp                    |   |   |   |
|Lockdown Wall           |   |   |   |
|Mafia                   |   |   |   |
|Manhole                 |   |   |   |
|Mayor                   |   |   |   |
|Mine                    |   |   |   |
|Musician                |   |   |   |
|Oil Spill               |✗ |   |   |
|Police Box              |   |   |   |
|Power Box               |   |   |   |
|SlimeBarrel             |✗ |   |   |
|Tracks                  |   |   |   |
|Trash Can               |✓ |   |   |
|Tree                    |✓ |   |   |
|Vending Machine         |   |   |   |
|Vendor Cart             |   |   |   |

### Map Size *

Standard Chunk count for a map is 30.

|Name                           |Chunks Per Map, est.|
|:------------------------------|-------------------:|
|A City for Ants?!              |4
|Claustrophobia                 |12
|Megalopolis                    |48
|Ultrapolis                     |64

### Population *

|Name                           |Roaming NPC Multiplier|
|:------------------------------|---------------------:|
|Ghost Town                     | 0 %
|Let Me See That Throng         | 400 %
|Swarm Welcome                  | 800 %

### Quest Count *

|Name                           |Force Quest Count Per Floor|
|:------------------------------|--------------------------:|
|Rushin' Revolution             |0
|Single-Minded                  |1
|Workhorse                      |4

### Quest Rewards *

|Name                           |Quest Rewards|
|:------------------------------|:------------|
|Double-Ply Rewards             |Free Item or Hire Vouchers
|Unpaid Internship              |Double XP only

### Roamers

|Name                           |Effect|
|:------------------------------|:-----|
|Hoodlum's Wonderland           |- Roaming Gang numbers increased (12 gangs for standard floor size)
|Mob Town                       |- Mafia Spawn in all Districts
|Young Men in the Neighborhood  |- Roaming Gangs spawn in all Districts

### Walls *

*N.B.: If a chunk uses non-randomized walls, they will not be affected by these mutators.*

|Name                           |Effect|
|:------------------------------|:-----|
|City of Steel                  |- All randomized walls will spawn as Steel.
|Green Living                   |- All randomized walls will spawn as Hedge.
|Panoptikopolis                 |- All randomized walls will spawn as Glass.
|Shanty Town                    |- All randomized walls will spawn as Wood.
|Spelunky Dory                  |- All randomized walls will spawn as Cave Wall.<br>- Boulders spawn in all districts.

---

## Object Interactions
- Manhole
  - Activate: Use Crowbar(15) to open

## Overhauls

These are all accessed via the Mutators menu. These affect large swathes of gameplay content.

### AnCapistan

### Chunks
- All Law Enforcement chunks disabled
- All Criminal-type chunks made more common

### Map Features
- All Pollution-related features made more common
- Most public good features disabled or made pay-only

### NPCs
- Law Enforcement roaming NPCs disabled
- Criminal roaming NPCs made more common

### Object Interactions
|Name                   |Effects
|:----------------------|
|Alarm Button           |- Now costs money
|Elevator               |- Now costs money
|Fire Hydrant           |- Now costs money
|Toilet                 |- Now costs money



### Mostly Automated Comfortable Inclusive Terrestrial Socialism

### Chunks
- Artistic & Nature chunks more common
- Shacks & Mansions disabled, replaced with apartments

### Map Features
- Public Good features more common
- Pollution features disabled

### NPCs
- Healing with Doctor is always free
- Thieves no longer spawn

### Object Interactions
|Name                   |Effects
|:----------------------|



### Police State

### Chunks
- Law Enforcement chunks always spawn
- Criminal-type chunks disabled

### Map Features
- Pollution-related features disabled
- Security Cameras now generate in public
- 
### NPCs
- Law Enforcers always spawn 
- Law Enforcers start out Annoyed
- If a Law Enforcer goes Hostile, you gain the Wanted Trait until you remove it [Methods TBD]
- Criminal roaming NPCs disabled

### Object Interactions
|Name                   |Effects
|:----------------------|
|Security Cam           |- Triggers alarm if anyone Wanted is detected

## Traits

### Additions

#### Experience Gain Rate

|Name                           |Value  |Experience Rate|
|:------------------------------|------:|--------------:|
|Dim Bulb                       |- 4    |75 %
|Moronic                        |- 8    |50 %
|Smooth-Brained                 |- 16   |0 %
|Very Hard-On Yourself          |- 2    |XP Loss 200 %

#### Miscellaneous

|Name                           |Value  |Camera Zoom Level|
|:------------------------------|------:|----------------:|
|Eagle Eyes                     |3      |60 %
|Eagle Eyes +                   |6      |40 %
|Myopic                         |- 4    |150 %
|Myopic +                       |- 8    |200 %

#### Social

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Domineering                    |2      |- 10% chance for NPC to be Submissive
|Domineering +                  |4      |- 20% chance for NPC to be Submissive
|Generally Unpleasant           |- 3    |- All NPCs have a 20% chance to start out Annoyed with you.
|Objectively Unpleasant         |- 8    |- All NPCs start out Annoyed.
|Polarizing                     |0      |- All NPCs start out either Annoyed or Friendly.
|Polarizing +                   |1      |- All NPCS start out Hostile, Annoyed, Friendly, Loyal, or Aligned.
|Veiled Threats                 |3      |- When you attempt to Bribe, Extort, Mug, or Threaten, a failure will turn the target Annoyed instead of Hostile.
|Warlord                        |16     |- You can make anyone Submissive by damaging them enough.

#### Spawns

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Haunted                        |- 2    |- Three hostile ghosts spawn in each level, and search for you.
|Mob Debt                       |- 10   |- Start with a $1,000 Debt. Remove it at the Upgrade Machine.<br>- If you still have this trait at Level 10, the Mafia will send Hit Squads after you.
|Mook Masher                    |- 4    |- An increasing number of armed and hostile Goons will try to track you down on each level. 
|Reinforcements                 |5      |- Spawns three Aligned Resistance Leaders, who roam the level and defend you.
|Reinforcements +               |10     |- Your allies are now armed and armored.

#### Stealth

|Name                           |Value  |Effect|
|:------------------------------|------:|:-----|
|Underdark Citizen              |2      |- Thieves and Cannibals hiding in Manholes no longer target you<br>- Activate or Fall in Open Manhole: Take no damage and teleport to another open Manhole<br>- Manholes spawn in all Districts

#
# Shelved
Out-of-scope features and notes for them; any bugs not worth fixing yet; avenues for codebase exploration

---

- AccessTools argument additions (new Type[1] {etc} often missing)
  - Slot machine may have been addressed
- SlotMachine drop cash:
  - See ObjectReal.DestroyMe2 line 72

- RandomSelection.LoadRandomness is a good place to find lists to modify 

- RogueLibs conflicts not working right
    ```  
    Abbysssal — 
    Available determines whether a trait will exist in the game. 
    IsActive determines whether that trait will appear in the game (can be toggled on/off in the Traits Menu at Home Base).
    I think you should just patch StatusEffects.GetUpgradeTraits
    ```

## AnCapistan
  - Many XP rewards converted into money rewards
  - Objects now cost money
    - Alarm Buttons 
      - Attempted
            ```
            [Message: Bunny Mod] ObjectReal_Interact: AlarmButton (1664)
            [Message: Bunny Mod] AlarmButton_DetermineButtons
            [Warning:  HarmonyX] AccessTools.DeclaredMethod: Could not find method for type ObjectReal and name Interact and parameters ()
            [Error  : Unity Log] NullReferenceException: Object reference not set to an instance of an object
            Stack trace:
            BunnyMod.Content.BunnyHeaderTools.GetMethodWithoutOverrides[T] (System.Reflection.MethodInfo method, System.Object callFrom) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            BunnyMod.Content.BMObjects.AlarmButton_DetermineButtons (AlarmButton __instance) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            AlarmButton.DetermineButtons () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            PlayfieldObject.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            BunnyMod.Content.BMObjects.ObjectReal_Interact (Agent agent, ObjectReal __instance) (at <6db2a189c9f94358a13f920d7777c3e6>:0)
            ObjectReal.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            AlarmButton.Interact (Agent agent) (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            InteractionHelper.UpdateInteractionHelper () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            Updater.UpdateInterface () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            Updater.Update () (at <5b00a25014d74f7f862ecdd1d48f7c04>:0)
            ```
    - Toilets 
      - Pay to use
    - Elevators 
      - Pay to use
    - Bathtubs 
      - Pay to use
    - Fire Hydrants 
      - Pay to use
      - No effect, but didn't have firefighter
            ```
            [Message: Bunny Mod] ObjectReal_Interact: FireHydrant (1679)
            [Info   : Unity Log] Window Lose Focus
            ```
  - NPCs
    - Firefighters
      - Only respond to fires in certain chunk types
      - Can pay them to put out fires if you want
    - More Thieves
    - More Drug Dealers
    - More Slum Dwellers
    - No Police, Cop Bots, or SuperCops
    - Upper Crusters 
      - Roam with bodyguards
      - Fewer in number
      - All aligned to each other
  - Purchase Admin access on computers

## MACITS
  - More happy/nature chunks
    - Greenhouse
    - Music Hall
  - Cops not annoyed at property damage
  - More musicians
  - Doctors are free
  - Replace Slum Dwellers and Upper-Crusters with Workers
  - No Thieves or Gangbangers
  - Vending machines almost all free
  - Chunks
    - No mansions/ gated communities/ Shacks
      - Replaced with simple houses and apartments
    - No arenas
    - No banks
    - No casinos
    - No churches
    - No Confiscation/Deportation Centers
    - No slave shops
    - No Zoos
## Police State
- Bribery disabled
- Chunks
  - Enable/disable, list already created
- Elevator requires access credentials 
  - Get from an UpperCruster
    - Neutralize, Mug, Pickpocket, etc.
      - Percent success based on skin/hair match
  - Register credentials in City database
    - Computer in Law Enforcement chunks
      - Ensure generation if not present in chunk
        - Random location within chunk
          - Far from door +
          - Owned Tiles +
          - In Cell ---
  - Buy fake pass from Fixer
    - Resistance Leader would work in meantime?
  - Hack Elevator
    - Failure means flood of law enforcement and lockout to that avenue
  - Bribe Clerk in Deportation Center
  - Buy Day Pass at Elevator
    - Not available if Wanted
    - Most expensive option
  - Shapeshifter in Upper-Cruster or other authorized person
- Roaming NPCs
  - Guilty NPCs automatically have Wanted, get beatdowns in public
  - Non-Humans no longer spawn in public areas
    - Cannibals
    - Zombies
    - Vampires
    - Werewolves are ok, they're hidden
- Secret Police NPC
  - Assassin-based
  - Silenced machine guns
  - This when you done fucked up good
- Security Cams
  - Always trigger for Wanted
  - Always trigger for Guilty
  - Don't spawn correctly on North-facing walls.
    - It is possible that SecurityCam has Snap-To-Wall behaviors built-in that Trashcans don't. 
      - Try removing this algorithm's snap-to-wall portions in order to not interrupt the Camera's code from doing its thing.
    - Postfixed SetVars with `shiftAmountS = -0.16f`
      - Didn't work
  - I think I get this algorithm now: the original spot they're locating is the blank between two placed trashcans. That's why you often see them right next to each other with a gap in between.
    - So you can probably greatly simplify this algorithm to just use the spot in the middle.
- The Law
  - This would be a whole different playstyle here, wouldn't it?
  - No removal of Wanted if you fuck up this badly. You're now persona non grata.
- Trait Contraindications
  - Cops Don't Care
    - They do
  - Wanted
    - You are
- Upper Cruster changes similar to AnCapistan
- Wanted Status
  - Not removeable if you have the Wanted trait to begin with
  - Applied if Cop goes Hostile
  - Can remove by accessing Police Station Computer
  - Applied automatically to all NPCs with Guilty
    - Exempt if Chunk Owner?
    - Types